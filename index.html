<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTGOTG - Got To Go On The Go</title>
    <meta name="description" content="Find clean, safe restrooms at any business nationwide. Rate and review restrooms to help others find the best facilities.">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .brand-text h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
            margin: 0;
        }

        .taglines {
            font-size: 0.9rem;
            color: #718096;
        }

        .tagline-primary {
            font-weight: 600;
        }

        .tagline-secondary {
            font-style: italic;
            font-size: 0.8rem;
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-login {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-login:hover {
            background: #667eea;
            color: white;
        }

        .btn-signup {
            background: #48bb78;
            color: white;
        }

        .btn-signup:hover {
            background: #38a169;
        }

        .main-content {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .search-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .search-title {
            text-align: center;
            margin-bottom: 1rem;
        }

        .search-title h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .search-subtitle {
            color: #718096;
            font-size: 1.1rem;
        }

        .search-form {
            display: flex;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-select {
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        .search-buttons {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-search {
            background: #48bb78;
            color: white;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .btn-location {
            background: #4299e1;
            color: white;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .view-controls {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-view {
            background: #667eea;
            color: white;
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
        }

        .btn-view.active {
            background: #553c9a;
        }

        .results-section {
            display: flex;
            gap: 2rem;
            min-height: 600px;
        }

        .map-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        #map {
            width: 100%;
            height: 600px;
            border-radius: 15px;
        }

        .results-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            max-height: 600px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .results-count {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
        }

        .load-more-btn {
            background: #667eea;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .business-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .business-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .business-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .business-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.25rem;
        }

        .business-category {
            background: #667eea;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .business-address {
            color: #718096;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        .rating-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .stars {
            display: flex;
            gap: 2px;
        }

        .star {
            color: #ffd700;
            font-size: 1.2rem;
        }

        .star.empty {
            color: #e2e8f0;
        }

        .rating-text {
            font-weight: 600;
            color: #2d3748;
        }

        .review-count {
            color: #718096;
            font-size: 0.9rem;
        }

        .quality-badges {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-spotless {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-clean {
            background: #bee3f8;
            color: #2a4365;
        }

        .badge-accessible {
            background: #e9d8fd;
            color: #553c9a;
        }

        .business-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .btn-rate {
            background: #48bb78;
            color: white;
            padding: 0.75rem 1.25rem;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .btn-directions {
            background: #4299e1;
            color: white;
            padding: 0.75rem 1.25rem;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .btn-claim {
            background: #ed8936;
            color: white;
            padding: 0.75rem 1.25rem;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .welcome-message {
            text-align: center;
            padding: 3rem 2rem;
            color: #718096;
        }

        .welcome-message h3 {
            font-size: 2rem;
            color: #2d3748;
            margin-bottom: 1rem;
        }

        .welcome-message p {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .business-name-modal {
            color: #667eea;
            font-weight: 600;
        }

        .restroom-types {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .restroom-type {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .restroom-type:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .restroom-type.selected {
            border-color: #667eea;
            background: #edf2f7;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .restroom-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .restroom-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #2d3748;
        }

        .accessibility-option {
            margin: 1.5rem 0;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .accessibility-option:hover {
            border-color: #4299e1;
            background: #f7fafc;
        }

        .accessibility-option.selected {
            border-color: #4299e1;
            background: #ebf8ff;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        .accessibility-icon {
            font-size: 2rem;
            color: #4299e1;
            margin-bottom: 0.5rem;
        }

        .rating-stars {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 2rem 0;
        }

        .rating-star {
            font-size: 2rem;
            color: #e2e8f0;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .rating-star:hover,
        .rating-star.selected {
            color: #ffd700;
        }

        .rating-display {
            text-align: center;
            margin: 1rem 0;
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
        }

        .amenities-section {
            margin: 2rem 0;
        }

        .amenities-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 1rem;
        }

        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .amenity-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .amenity-item:hover {
            background: #f7fafc;
            border-color: #cbd5e0;
        }

        .amenity-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .amenity-item.selected .amenity-checkbox {
            background: #48bb78;
            border-color: #48bb78;
            color: white;
        }

        .amenity-label {
            font-size: 0.9rem;
            color: #2d3748;
        }

        .review-section {
            margin: 2rem 0;
        }

        .review-notice {
            background: #fef5e7;
            border: 1px solid #f6e05e;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
            color: #744210;
        }

        .review-textarea {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
        }

        .review-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .btn-submit {
            background: #48bb78;
            color: white;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
        }

        .btn-cancel {
            background: #e2e8f0;
            color: #2d3748;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
        }

        .footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            margin-top: 4rem;
            padding: 3rem 2rem 2rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h4 {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 0.5rem;
        }

        .footer-section ul li a {
            color: #718096;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-section ul li a:hover {
            color: #667eea;
        }

        .footer-bottom {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e2e8f0;
            color: #718096;
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .brand-text h1 {
                font-size: 1.5rem;
            }

            .search-form {
                flex-direction: column;
                align-items: stretch;
            }

            .search-input {
                min-width: auto;
            }

            .results-section {
                flex-direction: column;
            }

            .restroom-types {
                grid-template-columns: 1fr;
            }

            .amenities-grid {
                grid-template-columns: 1fr;
            }

            .modal-actions {
                flex-direction: column;
            }
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #718096;
        }

        .error {
            text-align: center;
            padding: 2rem;
            color: #e53e3e;
            background: #fed7d7;
            border-radius: 8px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo-section">
            <img src="assets/gtgotg_logo_primary-BE-ZRW_Y.png" alt="GTGOTG Logo" class="logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="logo" style="display: none;">üöΩ</div>
            <div class="brand-text">
                <h1>GTGOTG</h1>
                <div class="taglines">
                    <div class="tagline-primary">"Every Restroom, Everywhere"</div>
                    <div class="tagline-secondary">"When you got to go on the go"</div>
                </div>
            </div>
        </div>
        <div class="auth-buttons">
            <button class="btn btn-login">Login</button>
            <button class="btn btn-signup">Sign Up</button>
        </div>
    </header>

    <main class="main-content">
        <section class="search-section">
            <div class="search-title">
                <h2>Find Clean, Safe Restrooms</h2>
                <p class="search-subtitle">Search ANY business nationwide by name, city, state, or ZIP code</p>
            </div>
            
            <div class="search-form">
                <input type="text" class="search-input" id="searchInput" placeholder="Enter business name, city, state, or ZIP code (e.g., 'McDonald's', 'Denver CO', '80104')">
                <select class="search-select" id="categoryFilter">
                    <option value="">All Businesses</option>
                    <option value="restaurant">Restaurants</option>
                    <option value="fast_food">Fast Food</option>
                    <option value="cafe">Coffee Shops</option>
                    <option value="fuel">Gas Stations</option>
                    <option value="convenience">Convenience Stores</option>
                    <option value="supermarket">Supermarkets</option>
                    <option value="mall">Shopping Centers</option>
                    <option value="hotel">Hotels</option>
                    <option value="entertainment">Entertainment</option>
                    <option value="hospital">Healthcare</option>
                    <option value="services">Services</option>
                    <option value="truck_stop">Truck Stops</option>
                    <option value="rest_area">Rest Areas</option>
                    <option value="recreation">Recreation</option>
                </select>
                <select class="search-select" id="resultsLimit">
                    <option value="25">25 results</option>
                    <option value="50">50 results</option>
                    <option value="75">75 results</option>
                    <option value="100">100 results</option>
                </select>
            </div>

            <div class="search-buttons">
                <button class="btn btn-search" id="searchBtn">üîç Search</button>
                <button class="btn btn-location" id="locationBtn">üìç Enable Location</button>
            </div>

            <div class="view-controls">
                <button class="btn btn-view active" id="mapListBtn">Map + List</button>
                <button class="btn btn-view" id="mapOnlyBtn">Map Only</button>
                <button class="btn btn-view" id="listOnlyBtn">List Only</button>
            </div>
        </section>

        <section class="results-section" id="resultsSection">
            <div class="map-container" id="mapContainer">
                <div id="map"></div>
            </div>
            <div class="results-container" id="resultsContainer">
                <div class="welcome-message">
                    <h3>Welcome to GTGOTG!</h3>
                    <p>Search for any business to find and rate their restrooms.<br>Help others find clean, safe restrooms nationwide!</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Rating Modal -->
    <div id="ratingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Rate this restroom (1-10 stars)</h3>
                <div class="business-name-modal" id="modalBusinessName"></div>
            </div>

            <div class="restroom-types">
                <div class="restroom-type" data-type="mens">
                    <span class="restroom-icon">üöπ</span>
                    <div class="restroom-label">Men's</div>
                </div>
                <div class="restroom-type" data-type="womens">
                    <span class="restroom-icon">üö∫</span>
                    <div class="restroom-label">Women's</div>
                </div>
                <div class="restroom-type" data-type="unisex">
                    <span class="restroom-icon">üöª</span>
                    <div class="restroom-label">Unisex/Family</div>
                </div>
            </div>

            <div class="accessibility-option" id="accessibilityOption">
                <div class="accessibility-icon">‚ôø</div>
                <div class="restroom-label">ADA Accessible Stall</div>
                <div style="font-size: 0.8rem; color: #718096; margin-top: 0.25rem;">Click if you used an accessible stall</div>
            </div>

            <div class="rating-stars" id="ratingStars">
                <span class="rating-star" data-rating="1">‚òÖ</span>
                <span class="rating-star" data-rating="2">‚òÖ</span>
                <span class="rating-star" data-rating="3">‚òÖ</span>
                <span class="rating-star" data-rating="4">‚òÖ</span>
                <span class="rating-star" data-rating="5">‚òÖ</span>
                <span class="rating-star" data-rating="6">‚òÖ</span>
                <span class="rating-star" data-rating="7">‚òÖ</span>
                <span class="rating-star" data-rating="8">‚òÖ</span>
                <span class="rating-star" data-rating="9">‚òÖ</span>
                <span class="rating-star" data-rating="10">‚òÖ</span>
            </div>

            <div class="rating-display" id="ratingDisplay">Select a rating</div>

            <div class="amenities-section">
                <div class="amenities-title">Restroom amenities available:</div>
                <div class="amenities-grid">
                    <div class="amenity-item" data-amenity="toilet_paper">
                        <div class="amenity-checkbox">‚úì</div>
                        <div class="amenity-label">Toilet Paper</div>
                    </div>
                    <div class="amenity-item" data-amenity="soap">
                        <div class="amenity-checkbox">‚úì</div>
                        <div class="amenity-label">Soap Available</div>
                    </div>
                    <div class="amenity-item" data-amenity="paper_towels">
                        <div class="amenity-checkbox">‚úì</div>
                        <div class="amenity-label">Paper Towels</div>
                    </div>
                    <div class="amenity-item" data-amenity="hand_dryer">
                        <div class="amenity-checkbox">‚úì</div>
                        <div class="amenity-label">Hand Dryer</div>
                    </div>
                    <div class="amenity-item" data-amenity="clean">
                        <div class="amenity-checkbox">‚úì</div>
                        <div class="amenity-label">Clean & Tidy</div>
                    </div>
                    <div class="amenity-item" data-amenity="running_water">
                        <div class="amenity-checkbox">‚úì</div>
                        <div class="amenity-label">Running Water</div>
                    </div>
                    <div class="amenity-item" data-amenity="trash_emptied">
                        <div class="amenity-checkbox">‚úì</div>
                        <div class="amenity-label">Trash Emptied</div>
                    </div>
                    <div class="amenity-item" data-amenity="well_lit">
                        <div class="amenity-checkbox">‚úì</div>
                        <div class="amenity-label">Well Lit</div>
                    </div>
                </div>
            </div>

            <div class="review-section">
                <div class="amenities-title">Add a review (optional)</div>
                <div class="review-notice">
                    Login required to write reviews and upload photos
                </div>
                <textarea class="review-textarea" placeholder="Share your experience... (login required)" disabled></textarea>
            </div>

            <div class="modal-actions">
                <button class="btn btn-submit" id="submitRating">Submit Rating</button>
                <button class="btn btn-cancel" id="cancelRating">Cancel</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>GTGOTG</h4>
                <ul>
                    <li><a href="#about">About Us</a></li>
                    <li><a href="#how-it-works">How It Works</a></li>
                    <li><a href="#safety">Safety First</a></li>
                    <li><a href="#accessibility">Accessibility</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>For Business Owners</h4>
                <ul>
                    <li><a href="#claim">Claim Your Listing</a></li>
                    <li><a href="#dashboard">Business Dashboard</a></li>
                    <li><a href="#verify">Get Verified</a></li>
                    <li><a href="#respond">Respond to Reviews</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Support</h4>
                <ul>
                    <li><a href="#help">Help Center</a></li>
                    <li><a href="#contact">Contact Us</a></li>
                    <li><a href="#report">Report Content</a></li>
                    <li><a href="#feedback">Send Feedback</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Legal</h4>
                <ul>
                    <li><a href="#privacy">Privacy Policy</a></li>
                    <li><a href="#terms">Terms of Service</a></li>
                    <li><a href="#guidelines">Community Guidelines</a></li>
                    <li><a href="#cookies">Cookie Policy</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 GTGOTG - Got To Go On The Go. All rights reserved. | Helping people find clean, safe restrooms nationwide.</p>
        </div>
    </footer>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        console.log('üöΩ GTGOTG - Got To Go On The Go - Initializing...');
        
        // Global variables
        let map;
        let markers = [];
        let currentBusinesses = [];
        let currentRating = 0;
        let selectedRestroomType = '';
        let selectedAccessibility = false;
        let selectedAmenities = new Set();
        let currentBusiness = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            setupEventListeners();
            console.log('üöΩ GTGOTG - Got To Go On The Go - Initialized successfully!');
        });

        // Initialize the map
        function initializeMap() {
            try {
                map = L.map('map').setView([39.7392, -104.9903], 10); // Denver, CO
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(map);
                
                console.log('üìç Map initialized successfully');
            } catch (error) {
                console.error('Map initialization error:', error);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search functionality
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            // Location functionality
            document.getElementById('locationBtn').addEventListener('click', enableLocation);

            // View controls
            document.getElementById('mapListBtn').addEventListener('click', () => setViewMode('mapList'));
            document.getElementById('mapOnlyBtn').addEventListener('click', () => setViewMode('mapOnly'));
            document.getElementById('listOnlyBtn').addEventListener('click', () => setViewMode('listOnly'));

            // Rating modal
            setupRatingModal();
        }

        // Perform search
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            const category = document.getElementById('categoryFilter').value;
            const limit = parseInt(document.getElementById('resultsLimit').value);

            if (!searchTerm) {
                alert('Please enter a search term');
                return;
            }

            console.log(`üîç Searching for: "${searchTerm}" in category: "${category}" with limit: ${limit}`);
            
            showLoading();
            searchBusinesses(searchTerm, category, limit);
        }

        // Search businesses using OpenStreetMap
        async function searchBusinesses(searchTerm, category, limit) {
            try {
                console.log(`üîç Searching OpenStreetMap for: "${searchTerm}"`);
                
                // First, try to geocode the search term to get coordinates
                const geocodeUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchTerm)}&limit=1&countrycodes=us`;
                
                const geocodeResponse = await fetch(geocodeUrl);
                const geocodeData = await geocodeResponse.json();
                
                let businesses = [];
                
                if (geocodeData.length > 0) {
                    const location = geocodeData[0];
                    const lat = parseFloat(location.lat);
                    const lon = parseFloat(location.lon);
                    
                    console.log(`üìç Found location: ${lat}, ${lon}`);
                    
                    // Search for businesses around this location using Overpass API
                    const overpassQuery = buildOverpassQuery(lat, lon, category, limit);
                    const overpassUrl = 'https://overpass-api.de/api/interpreter';
                    
                    const overpassResponse = await fetch(overpassUrl, {
                        method: 'POST',
                        body: overpassQuery,
                        headers: {
                            'Content-Type': 'text/plain'
                        }
                    });
                    
                    const overpassData = await overpassResponse.json();
                    businesses = processOverpassResults(overpassData);
                    
                    // Center map on search location
                    map.setView([lat, lon], 12);
                }
                
                // If no businesses found or search failed, show sample data
                if (businesses.length === 0) {
                    console.log('üìç No businesses found via API, showing sample data');
                    businesses = generateSampleBusinesses(searchTerm, limit);
                }
                
                displayResults(businesses);
                
            } catch (error) {
                console.error('Search error:', error);
                // Fallback to sample data
                const businesses = generateSampleBusinesses(searchTerm, limit);
                displayResults(businesses);
            }
        }

        // Build Overpass API query
        function buildOverpassQuery(lat, lon, category, limit) {
            const radius = 5000; // 5km radius
            
            let amenityFilter = '';
            if (category) {
                switch (category) {
                    case 'restaurant':
                        amenityFilter = '[amenity~"^(restaurant|bar|pub)$"]';
                        break;
                    case 'fast_food':
                        amenityFilter = '[amenity="fast_food"]';
                        break;
                    case 'cafe':
                        amenityFilter = '[amenity~"^(cafe|coffee)$"]';
                        break;
                    case 'fuel':
                        amenityFilter = '[amenity="fuel"]';
                        break;
                    case 'convenience':
                        amenityFilter = '[shop="convenience"]';
                        break;
                    case 'supermarket':
                        amenityFilter = '[shop~"^(supermarket|department_store)$"]';
                        break;
                    case 'hotel':
                        amenityFilter = '[tourism~"^(hotel|motel)$"]';
                        break;
                    case 'hospital':
                        amenityFilter = '[amenity~"^(hospital|clinic)$"]';
                        break;
                    default:
                        amenityFilter = '[amenity][name]';
                }
            } else {
                amenityFilter = '[amenity][name]';
            }
            
            return `
                [out:json][timeout:25];
                (
                  node${amenityFilter}(around:${radius},${lat},${lon});
                  way${amenityFilter}(around:${radius},${lat},${lon});
                  relation${amenityFilter}(around:${radius},${lat},${lon});
                );
                out center meta;
            `;
        }

        // Process Overpass API results
        function processOverpassResults(data) {
            const businesses = [];
            
            if (data.elements) {
                data.elements.forEach(element => {
                    if (element.tags && element.tags.name) {
                        let lat, lon;
                        
                        if (element.lat && element.lon) {
                            lat = element.lat;
                            lon = element.lon;
                        } else if (element.center) {
                            lat = element.center.lat;
                            lon = element.center.lon;
                        } else {
                            return; // Skip if no coordinates
                        }
                        
                        const business = {
                            id: element.id,
                            name: element.tags.name,
                            address: formatAddress(element.tags),
                            category: determineCategory(element.tags),
                            lat: lat,
                            lon: lon,
                            rating: (Math.random() * 4 + 6).toFixed(1), // Random rating 6-10
                            reviewCount: Math.floor(Math.random() * 200) + 20,
                            badges: generateRandomBadges()
                        };
                        
                        businesses.push(business);
                    }
                });
            }
            
            return businesses.slice(0, 25); // Limit results
        }

        // Format address from OSM tags
        function formatAddress(tags) {
            const parts = [];
            if (tags['addr:housenumber']) parts.push(tags['addr:housenumber']);
            if (tags['addr:street']) parts.push(tags['addr:street']);
            if (tags['addr:city']) parts.push(tags['addr:city']);
            if (tags['addr:state']) parts.push(tags['addr:state']);
            if (tags['addr:postcode']) parts.push(tags['addr:postcode']);
            
            return parts.length > 0 ? parts.join(', ') : 'Address not available';
        }

        // Determine business category from OSM tags
        function determineCategory(tags) {
            if (tags.amenity) {
                switch (tags.amenity) {
                    case 'restaurant': return 'Restaurant';
                    case 'fast_food': return 'Fast Food';
                    case 'cafe': return 'Coffee Shop';
                    case 'fuel': return 'Gas Station';
                    case 'hospital': return 'Hospital';
                    case 'bank': return 'Bank';
                    default: return 'Business';
                }
            }
            if (tags.shop) {
                switch (tags.shop) {
                    case 'convenience': return 'Convenience Store';
                    case 'supermarket': return 'Supermarket';
                    default: return 'Shop';
                }
            }
            if (tags.tourism) {
                switch (tags.tourism) {
                    case 'hotel': return 'Hotel';
                    case 'motel': return 'Motel';
                    default: return 'Tourism';
                }
            }
            return 'Business';
        }

        // Generate sample businesses for fallback
        function generateSampleBusinesses(searchTerm, limit) {
            const sampleBusinesses = [
                {
                    id: 1,
                    name: "McDonald's",
                    address: "1234 Main Street, Denver, CO, 80202",
                    category: "Fast Food",
                    lat: 39.7392,
                    lon: -104.9903,
                    rating: "7.3",
                    reviewCount: 158,
                    badges: ["CLEAN", "ACCESSIBLE"]
                },
                {
                    id: 2,
                    name: "Starbucks",
                    address: "5678 Broadway, Denver, CO, 80203",
                    category: "Coffee Shop",
                    lat: 39.7292,
                    lon: -104.9803,
                    rating: "8.7",
                    reviewCount: 203,
                    badges: ["SPOTLESS", "ACCESSIBLE"]
                },
                {
                    id: 3,
                    name: "Shell Gas Station",
                    address: "9012 Federal Blvd, Denver, CO, 80204",
                    category: "Gas Station",
                    lat: 39.7492,
                    lon: -105.0003,
                    rating: "6.8",
                    reviewCount: 89,
                    badges: ["CLEAN"]
                },
                {
                    id: 4,
                    name: "Walmart Supercenter",
                    address: "3456 Colorado Blvd, Denver, CO, 80205",
                    category: "Supermarket",
                    lat: 39.7192,
                    lon: -104.9703,
                    rating: "7.9",
                    reviewCount: 312,
                    badges: ["ACCESSIBLE", "CLEAN"]
                },
                {
                    id: 5,
                    name: "Target",
                    address: "7890 Colfax Ave, Denver, CO, 80206",
                    category: "Shopping",
                    lat: 39.7592,
                    lon: -104.9603,
                    rating: "8.2",
                    reviewCount: 176,
                    badges: ["SPOTLESS", "ACCESSIBLE"]
                }
            ];
            
            return sampleBusinesses.slice(0, Math.min(limit, sampleBusinesses.length));
        }

        // Generate random quality badges
        function generateRandomBadges() {
            const allBadges = ["SPOTLESS", "CLEAN", "ACCESSIBLE"];
            const numBadges = Math.floor(Math.random() * 3) + 1;
            const shuffled = allBadges.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, numBadges);
        }

        // Display search results
        function displayResults(businesses) {
            currentBusinesses = businesses;
            
            // Clear existing markers
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            
            // Update results container
            const resultsContainer = document.getElementById('resultsContainer');
            
            if (businesses.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="error">
                        <h3>No businesses found</h3>
                        <p>Try a different search term or location.</p>
                        <p><strong>Available ZIP codes:</strong> 80104, 80202, 90210, 10001</p>
                    </div>
                `;
                return;
            }
            
            // Create results header
            const resultsHeader = `
                <div class="results-header">
                    <div class="results-count">Showing 1-${businesses.length} of ${businesses.length} businesses</div>
                    ${businesses.length >= 25 ? '<button class="load-more-btn">Load 25 More</button>' : ''}
                </div>
            `;
            
            // Create business cards
            const businessCards = businesses.map(business => createBusinessCard(business)).join('');
            
            resultsContainer.innerHTML = resultsHeader + businessCards;
            
            // Add markers to map
            businesses.forEach(business => {
                const marker = L.marker([business.lat, business.lon])
                    .addTo(map)
                    .bindPopup(`
                        <div style="text-align: center; min-width: 200px;">
                            <h4 style="margin: 0 0 0.5rem 0; color: #2d3748;">${business.name}</h4>
                            <p style="margin: 0 0 0.5rem 0; color: #718096; font-size: 0.9rem;">${business.category}</p>
                            <p style="margin: 0 0 1rem 0; color: #718096; font-size: 0.8rem;">${business.address}</p>
                            <div style="display: flex; gap: 0.5rem; justify-content: center;">
                                <button onclick="openRatingModal(${business.id})" style="background: #48bb78; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">Rate Restroom</button>
                                <button onclick="getDirections(${business.lat}, ${business.lon})" style="background: #4299e1; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">Directions</button>
                            </div>
                        </div>
                    `);
                
                markers.push(marker);
            });
            
            // Fit map to show all markers
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        // Create business card HTML
        function createBusinessCard(business) {
            const stars = generateStarsHTML(parseFloat(business.rating));
            const badges = business.badges.map(badge => 
                `<span class="badge badge-${badge.toLowerCase()}">${badge}</span>`
            ).join('');
            
            return `
                <div class="business-card">
                    <div class="business-header">
                        <div>
                            <div class="business-name">${business.name}</div>
                            <div class="business-address">${business.address}</div>
                        </div>
                        <div class="business-category">${business.category}</div>
                    </div>
                    
                    <div class="rating-section">
                        <div class="stars">${stars}</div>
                        <div class="rating-text">${business.rating}/10</div>
                        <div class="review-count">(${business.reviewCount} reviews)</div>
                    </div>
                    
                    <div class="quality-badges">${badges}</div>
                    
                    <div class="business-actions">
                        <button class="btn btn-rate" onclick="openRatingModal(${business.id})">Rate Restroom</button>
                        <button class="btn btn-directions" onclick="getDirections(${business.lat}, ${business.lon})">Directions</button>
                        <button class="btn btn-claim">Claim Listing</button>
                    </div>
                </div>
            `;
        }

        // Generate stars HTML
        function generateStarsHTML(rating) {
            let starsHTML = '';
            const fullStars = Math.floor(rating);
            
            for (let i = 1; i <= 10; i++) {
                if (i <= fullStars) {
                    starsHTML += '<span class="star">‚òÖ</span>';
                } else {
                    starsHTML += '<span class="star empty">‚òÖ</span>';
                }
            }
            
            return starsHTML;
        }

        // Show loading state
        function showLoading() {
            document.getElementById('resultsContainer').innerHTML = `
                <div class="loading">
                    <h3>Searching...</h3>
                    <p>Finding businesses near you...</p>
                </div>
            `;
        }

        // Enable location
        function enableLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        map.setView([lat, lon], 13);
                        
                        // Search for businesses near current location
                        searchBusinesses(`${lat},${lon}`, '', 25);
                    },
                    function(error) {
                        alert('Unable to get your location. Please search manually.');
                        console.error('Geolocation error:', error);
                    }
                );
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }

        // Set view mode
        function setViewMode(mode) {
            const mapContainer = document.getElementById('mapContainer');
            const resultsContainer = document.getElementById('resultsContainer');
            const buttons = document.querySelectorAll('.btn-view');
            
            // Remove active class from all buttons
            buttons.forEach(btn => btn.classList.remove('active'));
            
            switch (mode) {
                case 'mapList':
                    mapContainer.style.display = 'block';
                    resultsContainer.style.display = 'block';
                    document.getElementById('mapListBtn').classList.add('active');
                    break;
                case 'mapOnly':
                    mapContainer.style.display = 'block';
                    resultsContainer.style.display = 'none';
                    document.getElementById('mapOnlyBtn').classList.add('active');
                    break;
                case 'listOnly':
                    mapContainer.style.display = 'none';
                    resultsContainer.style.display = 'block';
                    document.getElementById('listOnlyBtn').classList.add('active');
                    break;
            }
            
            // Resize map after view change
            setTimeout(() => {
                if (map) {
                    map.invalidateSize();
                }
            }, 100);
        }

        // Get directions
        function getDirections(lat, lon) {
            const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}`;
            window.open(url, '_blank');
        }

        // Setup rating modal
        function setupRatingModal() {
            const modal = document.getElementById('ratingModal');
            const cancelBtn = document.getElementById('cancelRating');
            const submitBtn = document.getElementById('submitRating');
            
            // Close modal when clicking cancel or outside
            cancelBtn.addEventListener('click', closeRatingModal);
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    closeRatingModal();
                }
            });
            
            // Restroom type selection
            document.querySelectorAll('.restroom-type').forEach(type => {
                type.addEventListener('click', function() {
                    document.querySelectorAll('.restroom-type').forEach(t => t.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedRestroomType = this.dataset.type;
                });
            });
            
            // Accessibility option
            document.getElementById('accessibilityOption').addEventListener('click', function() {
                this.classList.toggle('selected');
                selectedAccessibility = this.classList.contains('selected');
            });
            
            // Rating stars
            document.querySelectorAll('.rating-star').forEach(star => {
                star.addEventListener('click', function() {
                    currentRating = parseInt(this.dataset.rating);
                    updateStarDisplay();
                    updateRatingDisplay();
                });
                
                star.addEventListener('mouseenter', function() {
                    const rating = parseInt(this.dataset.rating);
                    highlightStars(rating);
                });
            });
            
            document.getElementById('ratingStars').addEventListener('mouseleave', function() {
                updateStarDisplay();
            });
            
            // Amenities
            document.querySelectorAll('.amenity-item').forEach(item => {
                item.addEventListener('click', function() {
                    const amenity = this.dataset.amenity;
                    if (selectedAmenities.has(amenity)) {
                        selectedAmenities.delete(amenity);
                        this.classList.remove('selected');
                    } else {
                        selectedAmenities.add(amenity);
                        this.classList.add('selected');
                    }
                });
            });
            
            // Submit rating
            submitBtn.addEventListener('click', submitRating);
        }

        // Open rating modal
        function openRatingModal(businessId) {
            currentBusiness = currentBusinesses.find(b => b.id == businessId);
            if (!currentBusiness) return;
            
            document.getElementById('modalBusinessName').textContent = currentBusiness.name;
            document.getElementById('ratingModal').style.display = 'block';
            
            // Reset form
            resetRatingForm();
        }

        // Close rating modal
        function closeRatingModal() {
            document.getElementById('ratingModal').style.display = 'none';
            resetRatingForm();
        }

        // Reset rating form
        function resetRatingForm() {
            currentRating = 0;
            selectedRestroomType = '';
            selectedAccessibility = false;
            selectedAmenities.clear();
            
            document.querySelectorAll('.restroom-type').forEach(t => t.classList.remove('selected'));
            document.getElementById('accessibilityOption').classList.remove('selected');
            document.querySelectorAll('.amenity-item').forEach(item => item.classList.remove('selected'));
            
            updateStarDisplay();
            updateRatingDisplay();
        }

        // Update star display
        function updateStarDisplay() {
            document.querySelectorAll('.rating-star').forEach((star, index) => {
                if (index < currentRating) {
                    star.classList.add('selected');
                } else {
                    star.classList.remove('selected');
                }
            });
        }

        // Highlight stars on hover
        function highlightStars(rating) {
            document.querySelectorAll('.rating-star').forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('selected');
                } else {
                    star.classList.remove('selected');
                }
            });
        }

        // Update rating display
        function updateRatingDisplay() {
            const display = document.getElementById('ratingDisplay');
            if (currentRating > 0) {
                display.textContent = `${currentRating}/10 stars`;
            } else {
                display.textContent = 'Select a rating';
            }
        }

        // Submit rating
        function submitRating() {
            if (!selectedRestroomType) {
                alert('Please select which restroom you used');
                return;
            }
            
            if (currentRating === 0) {
                alert('Please select a rating');
                return;
            }
            
            // Create rating object
            const rating = {
                businessId: currentBusiness.id,
                businessName: currentBusiness.name,
                restroomType: selectedRestroomType,
                accessibility: selectedAccessibility,
                rating: currentRating,
                amenities: Array.from(selectedAmenities),
                timestamp: new Date().toISOString()
            };
            
            console.log('Rating submitted:', rating);
            
            // Show success message
            let restroomTypeText = '';
            switch (selectedRestroomType) {
                case 'mens': restroomTypeText = "Men's"; break;
                case 'womens': restroomTypeText = "Women's"; break;
                case 'unisex': restroomTypeText = "Unisex/Family"; break;
            }
            
            if (selectedAccessibility) {
                restroomTypeText += " + Accessible";
            }
            
            alert(`Thank you! Your ${currentRating}/10 star rating for the ${restroomTypeText} restroom at ${currentBusiness.name} has been submitted.`);
            
            closeRatingModal();
        }

        // Make functions globally available
        window.openRatingModal = openRatingModal;
        window.getDirections = getDirections;
    </script>
</body>
</html>

