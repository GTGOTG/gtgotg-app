<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚽 Got To Go On The Go - Find Clean Restrooms Anywhere</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Find clean, safe restrooms anywhere in the USA. Specializing in truck stops, rest areas, gas stations, and traveler-friendly locations with real-time search.">
    <meta name="keywords" content="restroom finder, bathroom locator, truck stops, rest areas, gas stations, travel, clean restrooms, public restrooms">
    <meta name="author" content="GTGOTG Team">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gtgotg.com/">
    <meta property="og:title" content="🚽 Got To Go On The Go - Find Clean Restrooms Anywhere">
    <meta property="og:description" content="Find clean, safe restrooms anywhere in the USA. Specializing in truck stops, rest areas, gas stations, and traveler-friendly locations.">
    <meta property="og:image" content="https://gtgotg.com/thumbnail.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://gtgotg.com/">
    <meta property="twitter:title" content="🚽 Got To Go On The Go - Find Clean Restrooms Anywhere">
    <meta property="twitter:description" content="Find clean, safe restrooms anywhere in the USA. Specializing in truck stops, rest areas, gas stations, and traveler-friendly locations.">
    <meta property="twitter:image" content="https://gtgotg.com/thumbnail.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="logo.png">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            border-radius: 12px;
        }
        
        .brand-text {
            color: white;
        }
        
        .brand-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0;
        }
        
        .brand-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin: 0;
        }
        
        .header-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .admin-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .admin-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .hero {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }
        
        .search-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .search-form {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        .search-input:focus {
            border-color: #667eea;
        }
        
        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: transform 0.3s ease;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
        }
        
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .filter-label {
            font-weight: bold;
            color: #333;
        }
        
        .filter-select {
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        .filter-select:focus {
            border-color: #667eea;
        }
        
        .category-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .category-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .category-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-2px);
        }
        
        .category-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        
        .map-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .map-header {
            background: #f8f9fa;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .map-title {
            font-weight: bold;
            color: #333;
        }
        
        .map-expand-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }
        
        .map-expand-btn:hover {
            background: #5a6fd8;
        }
        
        #map {
            height: 300px;
            width: 100%;
            transition: height 0.3s ease;
        }
        
        #map.expanded {
            height: 600px;
        }
        
        .results-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .results-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }
        
        .results-stats {
            background: #f8f9ff;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #667eea;
        }
        
        .business-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }
        
        .business-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .business-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .business-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .business-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .business-type {
            background: #667eea;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .business-address {
            color: #666;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .business-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .business-distance {
            color: #667eea;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .restroom-probability {
            background: #4CAF50;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .restroom-probability.medium {
            background: #FF9800;
        }
        
        .restroom-probability.low {
            background: #f44336;
        }
        
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        
        .admin-content {
            background: white;
            width: 90%;
            max-width: 600px;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 12px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 1rem;
        }
        
        .admin-close {
            background: #f44336;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #c62828;
        }
        
        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #2e7d32;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .logo-section {
                justify-content: center;
            }
            
            .brand-title {
                font-size: 1.5rem;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .search-form {
                flex-direction: column;
            }
            
            .search-input {
                min-width: auto;
            }
            
            .category-buttons {
                grid-template-columns: 1fr;
            }
            
            .business-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo-section">
            <img src="logo.png" alt="GTGOTG Logo" class="logo">
            <div class="brand-text">
                <h1 class="brand-title">Got To Go On The Go</h1>
                <p class="brand-subtitle">Find clean, safe restrooms anywhere in the USA - Truck Stops, Rest Areas & More!</p>
            </div>
        </div>
        <div class="header-buttons">
            <button class="admin-btn" onclick="showAdminPanel()">🔐 Admin</button>
        </div>
    </header>

    <div class="container">
        <section class="hero">
            <h1>🚽 Every Restroom, Everywhere</h1>
            <p>Your trusted guide to clean, safe restrooms across America</p>
        </section>

        <section class="search-section">
            <div class="search-form">
                <input type="text" id="locationInput" class="search-input" placeholder="Enter city, state, or address (e.g., Denver, CO)">
                <button onclick="searchBusinesses()" class="search-btn">🔍 Find Restrooms</button>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label class="filter-label">Search Radius</label>
                    <select id="radiusSelect" class="filter-select">
                        <option value="5">5 km (~3 miles)</option>
                        <option value="10">10 km (~6 miles)</option>
                        <option value="25" selected>25 km (~15 miles)</option>
                        <option value="50">50 km (~30 miles)</option>
                    </select>
                </div>
            </div>

            <div class="category-buttons">
                <button class="category-btn active" data-category="truck_stops" onclick="selectCategory(this, 'truck_stops')">
                    🚛 Truck Stops & Rest Areas
                </button>
                <button class="category-btn" data-category="gas_stations" onclick="selectCategory(this, 'gas_stations')">
                    ⛽ Gas Stations
                </button>
                <button class="category-btn" data-category="restaurants" onclick="selectCategory(this, 'restaurants')">
                    🍔 Restaurants & Fast Food
                </button>
                <button class="category-btn" data-category="shopping" onclick="selectCategory(this, 'shopping')">
                    🏪 Shopping & Retail
                </button>
                <button class="category-btn" data-category="hotels" onclick="selectCategory(this, 'hotels')">
                    🏨 Hotels & Lodging
                </button>
                <button class="category-btn" data-category="all" onclick="selectCategory(this, 'all')">
                    🎯 All Categories
                </button>
            </div>
        </section>

        <section class="map-container">
            <div class="map-header">
                <h3 class="map-title">📍 Interactive Map</h3>
                <button class="map-expand-btn" onclick="toggleMapSize()">🔍 Expand</button>
            </div>
            <div id="map"></div>
        </section>

        <section class="results-section">
            <div class="results-header">
                <h2 class="results-title">🚽 Restroom Locations</h2>
                <div class="results-stats" id="resultsStats">Ready to search</div>
            </div>
            <div id="businessResults" class="business-grid">
                <div class="loading">
                    <p>🔍 Enter a location above to find nearby restrooms</p>
                    <p style="margin-top: 1rem; font-size: 0.9rem; color: #888;">
                        Try searching for "Denver, CO" or "truck stops near me"
                    </p>
                </div>
            </div>
        </section>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <div class="admin-content">
            <div class="admin-header">
                <h2>🔐 Admin Dashboard</h2>
                <button class="admin-close" onclick="hideAdminPanel()">✕ Close</button>
            </div>
            <div id="adminContent">
                <div class="loading">Loading admin data...</div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Global variables
        let map;
        let currentMarkers = [];
        let selectedCategory = 'truck_stops';
        let currentLocation = null;
        
        // Geoapify API configuration
        const GEOAPIFY_API_KEY = '0dd9c79bbb8d4b189288ae96d8c614f6';
        
        // Category mappings for Geoapify
        const categoryMappings = {
            truck_stops: ['commercial.gas_station', 'tourism.information.rest_area', 'commercial.truck_stop'],
            gas_stations: ['commercial.gas_station'],
            restaurants: ['commercial.food_and_drink.restaurant', 'commercial.food_and_drink.fast_food', 'commercial.food_and_drink.cafe'],
            shopping: ['commercial.supermarket', 'commercial.shopping_mall', 'commercial.department_store'],
            hotels: ['accommodation.hotel', 'accommodation.motel'],
            all: ['commercial.gas_station', 'commercial.food_and_drink', 'commercial.supermarket', 'accommodation.hotel', 'tourism.information.rest_area']
        };
        
        // Chain store recognition for higher restroom probability
        const chainStores = [
            'McDonald\'s', 'Starbucks', 'Subway', 'KFC', 'Burger King', 'Taco Bell', 'Pizza Hut',
            'Walmart', 'Target', 'Home Depot', 'Lowe\'s', 'CVS', 'Walgreens', 'Rite Aid',
            'Shell', 'Exxon', 'BP', 'Chevron', 'Mobil', 'Texaco', 'Citgo',
            'Pilot', 'Flying J', 'Love\'s', 'TA Travel Centers', 'Petro Stopping Centers',
            'Holiday Inn', 'Hampton Inn', 'Marriott', 'Hilton', 'Best Western'
        ];
        
        // Initialize map
        function initMap() {
            try {
                if (typeof L === 'undefined') {
                    setTimeout(initMap, 100);
                    return;
                }
                
                map = L.map('map').setView([39.8283, -98.5795], 4); // Center of USA
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(map);
                
                console.log('Map initialized successfully');
            } catch (error) {
                console.error('Error initializing map:', error);
                document.getElementById('map').innerHTML = '<div style="padding: 2rem; text-align: center; color: #666;">Map temporarily unavailable. Search results will still be displayed below.</div>';
            }
        }
        
        // Toggle map size
        function toggleMapSize() {
            try {
                const mapElement = document.getElementById('map');
                const button = document.querySelector('.map-expand-btn');
                
                if (mapElement.classList.contains('expanded')) {
                    mapElement.classList.remove('expanded');
                    button.textContent = '🔍 Expand';
                } else {
                    mapElement.classList.add('expanded');
                    button.textContent = '📏 Compact';
                }
                
                // Refresh map size after transition
                setTimeout(() => {
                    if (map) {
                        map.invalidateSize();
                    }
                }, 300);
            } catch (error) {
                console.error('Error toggling map size:', error);
            }
        }
        
        // Select category
        function selectCategory(button, category) {
            // Remove active class from all buttons
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to selected button
            button.classList.add('active');
            selectedCategory = category;
            
            // Re-search if location is set
            if (currentLocation) {
                searchBusinesses();
            }
        }
        
        // Geocode location using Geoapify
        async function geocodeLocation(location) {
            try {
                const response = await fetch(`https://api.geoapify.com/v1/geocode/search?text=${encodeURIComponent(location)}&apiKey=${GEOAPIFY_API_KEY}`);
                const data = await response.json();
                
                if (data.features && data.features.length > 0) {
                    const coords = data.features[0].geometry.coordinates;
                    return {
                        lat: coords[1],
                        lng: coords[0],
                        address: data.features[0].properties.formatted
                    };
                }
                throw new Error('Location not found');
            } catch (error) {
                console.error('Geocoding error:', error);
                throw error;
            }
        }
        
        // Search businesses using Geoapify
        async function searchNearbyBusinesses(lat, lng, category, radius) {
            try {
                const categories = categoryMappings[category] || categoryMappings.all;
                const categoryFilter = categories.join(',');
                
                const response = await fetch(`https://api.geoapify.com/v2/places?categories=${categoryFilter}&filter=circle:${lng},${lat},${radius * 1000}&limit=50&apiKey=${GEOAPIFY_API_KEY}`);
                const data = await response.json();
                
                if (data.features) {
                    return data.features.map(feature => {
                        const props = feature.properties;
                        const coords = feature.geometry.coordinates;
                        
                        // Calculate distance
                        const distance = calculateDistance(lat, lng, coords[1], coords[0]);
                        
                        // Determine business type and restroom probability
                        const businessType = getBusinessType(props);
                        const restroomProbability = getRestroomProbability(props.name, businessType);
                        
                        return {
                            id: props.place_id || Math.random().toString(36).substr(2, 9),
                            name: props.name || 'Unknown Business',
                            address: props.formatted || props.address_line1 || 'Address not available',
                            lat: coords[1],
                            lng: coords[0],
                            distance: distance,
                            type: businessType,
                            category: props.categories?.[0] || 'business',
                            restroomProbability: restroomProbability,
                            phone: props.contact?.phone,
                            website: props.contact?.website
                        };
                    });
                }
                return [];
            } catch (error) {
                console.error('Business search error:', error);
                return [];
            }
        }
        
        // Calculate distance between two points
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Earth's radius in kilometers
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // Get business type from properties
        function getBusinessType(props) {
            const categories = props.categories || [];
            
            if (categories.some(cat => cat.includes('gas_station') || cat.includes('truck_stop'))) {
                return 'Gas Station';
            }
            if (categories.some(cat => cat.includes('rest_area'))) {
                return 'Rest Area';
            }
            if (categories.some(cat => cat.includes('restaurant') || cat.includes('fast_food'))) {
                return 'Restaurant';
            }
            if (categories.some(cat => cat.includes('hotel') || cat.includes('motel'))) {
                return 'Hotel';
            }
            if (categories.some(cat => cat.includes('supermarket') || cat.includes('shopping'))) {
                return 'Shopping';
            }
            
            return 'Business';
        }
        
        // Get restroom probability based on business name and type
        function getRestroomProbability(name, type) {
            // Chain stores have higher probability
            const isChainStore = chainStores.some(chain => 
                name && name.toLowerCase().includes(chain.toLowerCase())
            );
            
            if (isChainStore) {
                return { score: 90, level: 'high' };
            }
            
            // Type-based probability
            switch (type) {
                case 'Gas Station':
                case 'Rest Area':
                    return { score: 95, level: 'high' };
                case 'Restaurant':
                case 'Hotel':
                    return { score: 85, level: 'high' };
                case 'Shopping':
                    return { score: 75, level: 'medium' };
                default:
                    return { score: 60, level: 'medium' };
            }
        }
        
        // Main search function
        async function searchBusinesses() {
            const locationInput = document.getElementById('locationInput').value.trim();
            const radiusSelect = document.getElementById('radiusSelect').value;
            const resultsContainer = document.getElementById('businessResults');
            const statsContainer = document.getElementById('resultsStats');
            
            if (!locationInput) {
                alert('Please enter a location to search');
                return;
            }
            
            // Show loading
            resultsContainer.innerHTML = '<div class="loading">🔍 Searching for restrooms...</div>';
            statsContainer.textContent = 'Searching...';
            
            try {
                // Geocode location
                const location = await geocodeLocation(locationInput);
                currentLocation = location;
                
                // Update map center
                if (map) {
                    map.setView([location.lat, location.lng], 12);
                }
                
                // Search businesses
                let businesses = await searchNearbyBusinesses(
                    location.lat, 
                    location.lng, 
                    selectedCategory, 
                    parseInt(radiusSelect)
                );
                
                // Sort by distance and restroom probability
                businesses.sort((a, b) => {
                    // Prioritize high probability restrooms
                    if (a.restroomProbability.level !== b.restroomProbability.level) {
                        if (a.restroomProbability.level === 'high') return -1;
                        if (b.restroomProbability.level === 'high') return 1;
                    }
                    return a.distance - b.distance;
                });
                
                // Ensure minimum results with progressive search
                if (businesses.length < 10) {
                    const expandedResults = await searchWithProgressiveRadius(location.lat, location.lng, selectedCategory);
                    businesses = [...businesses, ...expandedResults].slice(0, 50);
                }
                
                // Display results
                displayBusinessResults(businesses);
                updateMapMarkers(businesses);
                
                // Update stats
                const categoryName = getCategoryDisplayName(selectedCategory);
                statsContainer.textContent = `Found ${businesses.length} ${categoryName} near ${location.address}`;
                
            } catch (error) {
                console.error('Search error:', error);
                resultsContainer.innerHTML = `
                    <div class="error">
                        <strong>Search Error:</strong> ${error.message}
                        <br><br>
                        <button onclick="searchBusinesses()" style="background: #667eea; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
                            🔄 Try Again
                        </button>
                    </div>
                `;
                statsContainer.textContent = 'Search failed';
            }
        }
        
        // Progressive radius search for minimum results
        async function searchWithProgressiveRadius(lat, lng, category) {
            const radii = [30, 50, 100, 200]; // km
            let allResults = [];
            
            for (const radius of radii) {
                const results = await searchNearbyBusinesses(lat, lng, category, radius);
                allResults = [...allResults, ...results];
                
                if (allResults.length >= 10) {
                    break;
                }
            }
            
            // Remove duplicates and return
            const uniqueResults = allResults.filter((business, index, self) => 
                index === self.findIndex(b => b.name === business.name && Math.abs(b.lat - business.lat) < 0.001)
            );
            
            return uniqueResults;
        }
        
        // Display business results
        function displayBusinessResults(businesses) {
            const container = document.getElementById('businessResults');
            
            if (businesses.length === 0) {
                container.innerHTML = `
                    <div class="error">
                        <strong>No Results Found</strong>
                        <p>Try expanding your search radius or selecting a different category.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = businesses.map(business => `
                <div class="business-card" onclick="focusOnBusiness(${business.lat}, ${business.lng})">
                    <div class="business-header">
                        <div>
                            <div class="business-name">${business.name}</div>
                            <div class="business-address">${business.address}</div>
                        </div>
                        <div class="business-type">${getBusinessIcon(business.type)} ${business.type}</div>
                    </div>
                    <div class="business-details">
                        <div class="business-distance">📍 ${business.distance.toFixed(1)} km away</div>
                        <div class="restroom-probability ${business.restroomProbability.level}">
                            🚽 ${business.restroomProbability.score}% Restroom Likely
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Update map markers
        function updateMapMarkers(businesses) {
            if (!map) return;
            
            try {
                // Clear existing markers
                currentMarkers.forEach(marker => map.removeLayer(marker));
                currentMarkers = [];
                
                // Add new markers
                businesses.forEach(business => {
                    const icon = getMarkerIcon(business.type);
                    const marker = L.marker([business.lat, business.lng], { icon })
                        .addTo(map)
                        .bindPopup(`
                            <div style="min-width: 200px;">
                                <strong>${business.name}</strong><br>
                                <em>${business.type}</em><br>
                                ${business.address}<br>
                                <strong>Distance:</strong> ${business.distance.toFixed(1)} km<br>
                                <strong>Restroom Probability:</strong> ${business.restroomProbability.score}%
                            </div>
                        `);
                    
                    currentMarkers.push(marker);
                });
                
                // Fit map to show all markers
                if (currentMarkers.length > 0) {
                    const group = new L.featureGroup(currentMarkers);
                    map.fitBounds(group.getBounds().pad(0.1));
                }
            } catch (error) {
                console.error('Error updating map markers:', error);
            }
        }
        
        // Get marker icon based on business type
        function getMarkerIcon(type) {
            const iconMap = {
                'Gas Station': '⛽',
                'Rest Area': '🛣️',
                'Restaurant': '🍔',
                'Hotel': '🏨',
                'Shopping': '🏪',
                'Business': '🏢'
            };
            
            const emoji = iconMap[type] || '📍';
            
            return L.divIcon({
                html: `<div style="background: white; border: 2px solid #667eea; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 16px;">${emoji}</div>`,
                className: 'custom-marker',
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });
        }
        
        // Get business icon for display
        function getBusinessIcon(type) {
            const iconMap = {
                'Gas Station': '⛽',
                'Rest Area': '🛣️',
                'Restaurant': '🍔',
                'Hotel': '🏨',
                'Shopping': '🏪',
                'Business': '🏢'
            };
            return iconMap[type] || '🏢';
        }
        
        // Get category display name
        function getCategoryDisplayName(category) {
            const nameMap = {
                truck_stops: 'truck stops & rest areas',
                gas_stations: 'gas stations',
                restaurants: 'restaurants',
                shopping: 'shopping centers',
                hotels: 'hotels',
                all: 'businesses'
            };
            return nameMap[category] || 'businesses';
        }
        
        // Focus on business on map
        function focusOnBusiness(lat, lng) {
            if (map) {
                map.setView([lat, lng], 15);
            }
        }
        
        // Admin panel functions
        function showAdminPanel() {
            const username = prompt('Admin Username:');
            const password = prompt('Admin Password:');
            
            if (username === 'admin' && password === 'gtgotg2025') {
                document.getElementById('adminPanel').style.display = 'block';
                loadAdminData();
            } else {
                alert('Invalid credentials');
            }
        }
        
        function hideAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }
        
        function loadAdminData() {
            const adminContent = document.getElementById('adminContent');
            
            // Simulate admin data
            const stats = {
                totalSearches: Math.floor(Math.random() * 10000) + 5000,
                activeUsers: Math.floor(Math.random() * 500) + 200,
                businessesFound: Math.floor(Math.random() * 50000) + 25000,
                topSearches: ['Denver, CO', 'Los Angeles, CA', 'Chicago, IL', 'Houston, TX', 'Phoenix, AZ']
            };
            
            adminContent.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div style="background: #f8f9ff; padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: #667eea;">${stats.totalSearches.toLocaleString()}</div>
                        <div style="color: #666;">Total Searches</div>
                    </div>
                    <div style="background: #f8f9ff; padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: #667eea;">${stats.activeUsers.toLocaleString()}</div>
                        <div style="color: #666;">Active Users</div>
                    </div>
                    <div style="background: #f8f9ff; padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: #667eea;">${stats.businessesFound.toLocaleString()}</div>
                        <div style="color: #666;">Businesses Found</div>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 1rem;">📊 Top Search Locations</h3>
                <ul style="list-style: none; padding: 0;">
                    ${stats.topSearches.map((location, index) => `
                        <li style="background: #f8f9ff; padding: 0.8rem; margin-bottom: 0.5rem; border-radius: 6px; display: flex; justify-content: space-between;">
                            <span>${index + 1}. ${location}</span>
                            <span style="color: #667eea; font-weight: bold;">${Math.floor(Math.random() * 1000) + 100} searches</span>
                        </li>
                    `).join('')}
                </ul>
                
                <div style="margin-top: 2rem; padding: 1rem; background: #e8f5e8; border-radius: 8px; border-left: 4px solid #4CAF50;">
                    <strong>✅ System Status:</strong> All services operational<br>
                    <strong>🔗 API Status:</strong> Geoapify integration active<br>
                    <strong>📊 Database:</strong> ${Math.floor(Math.random() * 100000) + 50000} businesses indexed
                </div>
            `;
        }
        
        // Enter key support for search
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('locationInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchBusinesses();
                }
            });
        });
        
        // Initialize map when page loads
        window.addEventListener('load', function() {
            setTimeout(initMap, 500);
        });
        
        // Close admin panel when clicking outside
        document.getElementById('adminPanel').addEventListener('click', function(e) {
            if (e.target === this) {
                hideAdminPanel();
            }
        });
    </script>
</body>
</html>

